(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();const sr=!1;var Fr=Array.isArray,Fs=Array.prototype.indexOf,Ws=Array.from,At=Object.defineProperty,ze=Object.getOwnPropertyDescriptor,Ks=Object.getOwnPropertyDescriptors,zs=Object.prototype,Js=Array.prototype,Wr=Object.getPrototypeOf,nr=Object.isExtensible;function Hs(r){return r()}function Rt(r){for(var e=0;e<r.length;e++)r[e]()}function Gs(){var r,e,t=new Promise((s,n)=>{r=s,e=n});return{promise:t,resolve:r,reject:e}}const M=2,Kr=4,zr=8,Xe=16,Y=32,Ue=64,Jr=128,q=256,ut=512,$=1024,B=2048,ge=4096,oe=8192,Ze=16384,zt=32768,Jt=65536,ir=1<<17,Vs=1<<18,Hr=1<<19,Ht=1<<20,$t=1<<21,Gr=1<<22,ct=1<<23,Je=Symbol("$state"),Vr=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Qs(r){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Ys(r){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Xs(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Zs(r){throw new Error("https://svelte.dev/e/effect_orphan")}function en(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function tn(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function rn(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function sn(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}const nn=2,I=Symbol();function Qr(r){return r===this.v}function on(r,e){return r!=r?e==e:r!==e||r!==null&&typeof r=="object"||typeof r=="function"}function an(r){return!on(r,this.v)}let et=!1,ln=!1;function un(){et=!0}let P=null;function or(r){P=r}function Yr(r,e=!1,t){P={p:P,c:null,e:null,s:r,x:null,l:et&&!e?{s:null,u:null,$:[]}:null}}function Xr(r){var e=P,t=e.e;if(t!==null){e.e=null;for(var s of t)cs(s)}return P=e.p,{}}function pt(){return!et||P!==null&&P.l===null}const cn=new WeakMap;function hn(r){var e=S;if(e===null)return k.f|=ct,r;if((e.f&zt)===0){if((e.f&Jr)===0)throw!e.parent&&r instanceof Error&&es(r),r;e.b.error(r)}else Zr(r,e)}function Zr(r,e){for(;e!==null;){if((e.f&Jr)!==0)try{e.b.error(r);return}catch{}e=e.parent}throw r instanceof Error&&es(r),r}function es(r){const e=cn.get(r);e&&(At(r,"message",{value:e.message}),At(r,"stack",{value:e.stack}))}let ht=[];function dn(){var r=ht;ht=[],Rt(r)}function fn(r){ht.length===0&&queueMicrotask(dn),ht.push(r)}function vn(r){var e=M|B,t=k!==null&&(k.f&M)!==0?k:null;return S===null||t!==null&&(t.f&q)!==0?e|=q:S.f|=Hr,{ctx:P,deps:null,effects:null,equals:Qr,f:e,fn:r,reactions:null,rv:0,v:I,wv:0,parent:t??S,ac:null}}function ts(r){var e=r.effects;if(e!==null){r.effects=null;for(var t=0;t<e.length;t+=1)_e(e[t])}}function _n(r){for(var e=r.parent;e!==null;){if((e.f&M)===0)return e;e=e.parent}return null}function Gt(r){var e,t=S;Ce(_n(r));try{ts(r),e=ys(r)}finally{Ce(t)}return e}function rs(r){var e=Gt(r);if(r.equals(e)||(r.v=e,r.wv=ps()),!De)if(xe!==null)xe.set(r,r.v);else{var t=(se||(r.f&q)!==0)&&r.deps!==null?ge:$;x(r,t)}}const st=new Set;let z=null,xe=null;let Me=[],dt=null,xt=!1;class wt{#l=new Map;#i=new Map;#o=new Set;#t=0;#u=null;#c=!1;#s=[];#a=[];#r=[];#e=[];#n=[];skipped_effects=new Set;#d(e){Me=[];var t=null;if(st.size>1){t=new Map,xe=new Map;for(const[i,o]of this.#l)t.set(i,{v:i.v,wv:i.wv}),i.v=o;for(const i of st)if(i!==this)for(const[o,a]of i.#i)t.has(o)||(t.set(o,{v:o.v,wv:o.wv}),o.v=a)}for(const i of e)this.#f(i);if(this.#s.length===0&&this.#t===0){var s=this.#r,n=this.#e;this.#r=[],this.#e=[],this.#n=[],this.#h(),ar(s),ar(n),this.#u?.resolve()}else{for(const i of this.#r)x(i,$);for(const i of this.#e)x(i,$);for(const i of this.#n)x(i,$)}if(t){for(const[i,{v:o,wv:a}]of t)i.wv<=a&&(i.v=o);xe=null}for(const i of this.#s)He(i);for(const i of this.#a)He(i);this.#s=[],this.#a=[]}#f(e){e.f^=$;for(var t=e.first;t!==null;){var s=t.f,n=(s&(Y|Ue))!==0,i=n&&(s&$)!==0,o=i||(s&oe)!==0||this.skipped_effects.has(t);if(!o&&t.fn!==null){if(n)t.f^=$;else if((s&Kr)!==0)this.#e.push(t);else if(yt(t))if((s&Gr)!==0){var a=t.b?.pending?this.#a:this.#s;a.push(t)}else(t.f&Xe)!==0&&this.#n.push(t),He(t);var l=t.first;if(l!==null){t=l;continue}}var u=t.parent;for(t=t.next;t===null&&u!==null;)t=u.next,u=u.parent}}capture(e,t){this.#i.has(e)||this.#i.set(e,t),this.#l.set(e,e.v)}activate(){z=this}deactivate(){z=null}neuter(){this.#c=!0}flush(){Me.length>0?this.flush_effects():this.#h(),z===this&&(this.#t===0&&st.delete(this),z=null)}flush_effects(){var e=$e;xt=!0;try{var t=0;for(cr(!0);Me.length>0;)t++>1e3&&gn(),this.#d(Me),fe.clear()}finally{xt=!1,cr(e),dt=null}}#h(){if(!this.#c)for(const e of this.#o)e();this.#o.clear()}increment(){this.#t+=1}decrement(){if(this.#t-=1,this.#t===0){for(const e of this.#r)x(e,B),ie(e);for(const e of this.#e)x(e,B),ie(e);for(const e of this.#n)x(e,B),ie(e);this.#r=[],this.#e=[],this.flush()}}add_callback(e){this.#o.add(e)}settled(){return(this.#u??=Gs()).promise}static ensure(){if(z===null){const e=z=new wt;st.add(z),queueMicrotask(()=>{z===e&&e.flush()})}return z}}function gn(){try{en()}catch(r){if(dt!==null)Zr(r,dt);else throw r}}function ar(r){var e=r.length;if(e!==0){for(var t=0;t<e;t++){var s=r[t];if((s.f&(Ze|oe))===0&&yt(s)){var n=ft;if(He(s),s.deps===null&&s.first===null&&s.nodes_start===null&&(s.teardown===null?fs(s):s.fn=null),ft>n&&(s.f&Ht)!==0)break}}for(;t<e;t+=1)ie(r[t])}}function ie(r){for(var e=dt=r;e.parent!==null;){e=e.parent;var t=e.f;if(xt&&e===S&&(t&Xe)!==0)return;if((t&(Ue|Y))!==0){if((t&$)===0)return;e.f^=$}}Me.push(e)}const fe=new Map;function ss(r,e){var t={f:0,v:r,reactions:null,equals:Qr,rv:0,wv:0};return t}function X(r,e){const t=ss(r);return $n(t),t}function pn(r,e=!1,t=!0){const s=ss(r);return e||(s.equals=an),et&&t&&P!==null&&P.l!==null&&(P.l.s??=[]).push(s),s}function G(r,e,t=!1){k!==null&&(!J||(k.f&ir)!==0)&&pt()&&(k.f&(M|Xe|Gr|ir))!==0&&!Q?.includes(r)&&sn();let s=t?Fe(e):e;return wn(r,s)}function wn(r,e){if(!r.equals(e)){var t=r.v;De?fe.set(r,e):fe.set(r,t),r.v=e,wt.ensure().capture(r,t),(r.f&M)!==0&&((r.f&B)!==0&&Gt(r),x(r,(r.f&q)===0?$:ge)),r.wv=ps(),ns(r,B),pt()&&S!==null&&(S.f&$)!==0&&(S.f&(Y|Ue))===0&&(F===null?xn([r]):F.push(r))}return e}function bt(r){G(r,r.v+1)}function ns(r,e){var t=r.reactions;if(t!==null)for(var s=pt(),n=t.length,i=0;i<n;i++){var o=t[i],a=o.f;(a&B)===0&&(!s&&o===S||(x(o,e),(a&($|q))!==0&&((a&M)!==0?ns(o,ge):ie(o))))}}function Fe(r){if(typeof r!="object"||r===null||Je in r)return r;const e=Wr(r);if(e!==zs&&e!==Js)return r;var t=new Map,s=Fr(r),n=X(0),i=ve,o=a=>{if(ve===i)return a();var l=k,u=ve;ae(null),dr(i);var c=a();return ae(l),dr(u),c};return s&&t.set("length",X(r.length)),new Proxy(r,{defineProperty(a,l,u){(!("value"in u)||u.configurable===!1||u.enumerable===!1||u.writable===!1)&&tn();var c=t.get(l);return c===void 0?c=o(()=>{var h=X(u.value);return t.set(l,h),h}):G(c,u.value,!0),!0},deleteProperty(a,l){var u=t.get(l);if(u===void 0){if(l in a){const d=o(()=>X(I));t.set(l,d),bt(n)}}else{if(s&&typeof l=="string"){var c=t.get("length"),h=Number(l);Number.isInteger(h)&&h<c.v&&G(c,h)}G(u,I),bt(n)}return!0},get(a,l,u){if(l===Je)return r;var c=t.get(l),h=l in a;if(c===void 0&&(!h||ze(a,l)?.writable)&&(c=o(()=>{var f=Fe(h?a[l]:I),v=X(f);return v}),t.set(l,c)),c!==void 0){var d=ne(c);return d===I?void 0:d}return Reflect.get(a,l,u)},getOwnPropertyDescriptor(a,l){var u=Reflect.getOwnPropertyDescriptor(a,l);if(u&&"value"in u){var c=t.get(l);c&&(u.value=ne(c))}else if(u===void 0){var h=t.get(l),d=h?.v;if(h!==void 0&&d!==I)return{enumerable:!0,configurable:!0,value:d,writable:!0}}return u},has(a,l){if(l===Je)return!0;var u=t.get(l),c=u!==void 0&&u.v!==I||Reflect.has(a,l);if(u!==void 0||S!==null&&(!c||ze(a,l)?.writable)){u===void 0&&(u=o(()=>{var d=c?Fe(a[l]):I,f=X(d);return f}),t.set(l,u));var h=ne(u);if(h===I)return!1}return c},set(a,l,u,c){var h=t.get(l),d=l in a;if(s&&l==="length")for(var f=u;f<h.v;f+=1){var v=t.get(f+"");v!==void 0?G(v,I):f in a&&(v=o(()=>X(I)),t.set(f+"",v))}if(h===void 0)(!d||ze(a,l)?.writable)&&(h=o(()=>X(void 0)),G(h,Fe(u)),t.set(l,h));else{d=h.v!==I;var g=o(()=>Fe(u));G(h,g)}var _=Reflect.getOwnPropertyDescriptor(a,l);if(_?.set&&_.set.call(c,u),!d){if(s&&typeof l=="string"){var m=t.get("length"),E=Number(l);Number.isInteger(E)&&E>=m.v&&G(m,E+1)}bt(n)}return!0},ownKeys(a){ne(n);var l=Reflect.ownKeys(a).filter(h=>{var d=t.get(h);return d===void 0||d.v!==I});for(var[u,c]of t)c.v!==I&&!(u in a)&&l.push(u);return l},setPrototypeOf(){rn()}})}var lr,is,os,as;function yn(){if(lr===void 0){lr=window,is=/Firefox/.test(navigator.userAgent);var r=Element.prototype,e=Node.prototype,t=Text.prototype;os=ze(e,"firstChild").get,as=ze(e,"nextSibling").get,nr(r)&&(r.__click=void 0,r.__className=void 0,r.__attributes=null,r.__style=void 0,r.__e=void 0),nr(t)&&(t.__t=void 0)}}function Vt(r=""){return document.createTextNode(r)}function Qt(r){return os.call(r)}function ls(r){return as.call(r)}function ur(r,e){return Qt(r)}function mn(r,e){{var t=Qt(r);return t instanceof Comment&&t.data===""?ls(t):t}}function bn(){return!1}function us(r){S===null&&k===null&&Zs(),k!==null&&(k.f&q)!==0&&S===null&&Xs(),De&&Ys()}function kn(r,e){var t=e.last;t===null?e.last=e.first=r:(t.next=r,r.prev=t,e.last=r)}function Le(r,e,t,s=!0){var n=S;n!==null&&(n.f&oe)!==0&&(r|=oe);var i={ctx:P,deps:null,nodes_start:null,nodes_end:null,f:r|B,first:null,fn:e,last:null,next:null,parent:n,b:n&&n.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(t)try{He(i),i.f|=zt}catch(l){throw _e(i),l}else e!==null&&ie(i);var o=t&&i.deps===null&&i.first===null&&i.nodes_start===null&&i.teardown===null&&(i.f&Hr)===0;if(!o&&s&&(n!==null&&kn(i,n),k!==null&&(k.f&M)!==0)){var a=k;(a.effects??=[]).push(i)}return i}function Sn(r){const e=Le(zr,null,!1);return x(e,$),e.teardown=r,e}function Ct(r){us();var e=S.f,t=!k&&(e&Y)!==0&&(e&zt)===0;if(t){var s=P;(s.e??=[]).push(r)}else return cs(r)}function cs(r){return Le(Kr|Ht,r,!1)}function En(r){return us(),Le(zr|Ht,r,!0)}function Tn(r){wt.ensure();const e=Le(Ue,r,!0);return(t={})=>new Promise(s=>{t.outro?vs(e,()=>{_e(e),s(void 0)}):(_e(e),s(void 0))})}function jn(r,e=0){var t=Le(Xe|e,r,!0);return t}function It(r,e=!0){return Le(Y,r,!0,e)}function hs(r){var e=r.teardown;if(e!==null){const t=De,s=k;hr(!0),ae(null);try{e.call(null)}finally{hr(t),ae(s)}}}function ds(r,e=!1){var t=r.first;for(r.first=r.last=null;t!==null;){t.ac?.abort(Vr);var s=t.next;(t.f&Ue)!==0?t.parent=null:_e(t,e),t=s}}function On(r){for(var e=r.first;e!==null;){var t=e.next;(e.f&Y)===0&&_e(e),e=t}}function _e(r,e=!0){var t=!1;(e||(r.f&Vs)!==0)&&r.nodes_start!==null&&r.nodes_end!==null&&(Pn(r.nodes_start,r.nodes_end),t=!0),ds(r,e&&!t),vt(r,0),x(r,Ze);var s=r.transitions;if(s!==null)for(const i of s)i.stop();hs(r);var n=r.parent;n!==null&&n.first!==null&&fs(r),r.next=r.prev=r.teardown=r.ctx=r.deps=r.fn=r.nodes_start=r.nodes_end=r.ac=null}function Pn(r,e){for(;r!==null;){var t=r===e?null:ls(r);r.remove(),r=t}}function fs(r){var e=r.parent,t=r.prev,s=r.next;t!==null&&(t.next=s),s!==null&&(s.prev=t),e!==null&&(e.first===r&&(e.first=s),e.last===r&&(e.last=t))}function vs(r,e){var t=[];_s(r,t,!0),An(t,()=>{_e(r),e&&e()})}function An(r,e){var t=r.length;if(t>0){var s=()=>--t||e();for(var n of r)n.out(s)}else e()}function _s(r,e,t){if((r.f&oe)===0){if(r.f^=oe,r.transitions!==null)for(const o of r.transitions)(o.is_global||t)&&e.push(o);for(var s=r.first;s!==null;){var n=s.next,i=(s.f&Jt)!==0||(s.f&Y)!==0;_s(s,e,i?t:!1),s=n}}}function Rn(r){gs(r,!0)}function gs(r,e){if((r.f&oe)!==0){r.f^=oe,(r.f&$)===0&&(x(r,B),ie(r));for(var t=r.first;t!==null;){var s=t.next,n=(t.f&Jt)!==0||(t.f&Y)!==0;gs(t,n?e:!1),t=s}if(r.transitions!==null)for(const i of r.transitions)(i.is_global||e)&&i.in()}}let $e=!1;function cr(r){$e=r}let De=!1;function hr(r){De=r}let k=null,J=!1;function ae(r){k=r}let S=null;function Ce(r){S=r}let Q=null;function $n(r){k!==null&&(Q===null?Q=[r]:Q.push(r))}let U=null,N=0,F=null;function xn(r){F=r}let ft=1,Qe=0,ve=Qe;function dr(r){ve=r}let se=!1;function ps(){return++ft}function yt(r){var e=r.f;if((e&B)!==0)return!0;if((e&ge)!==0){var t=r.deps,s=(e&q)!==0;if(t!==null){var n,i,o=(e&ut)!==0,a=s&&S!==null&&!se,l=t.length;if((o||a)&&(S===null||(S.f&Ze)===0)){var u=r,c=u.parent;for(n=0;n<l;n++)i=t[n],(o||!i?.reactions?.includes(u))&&(i.reactions??=[]).push(u);o&&(u.f^=ut),a&&c!==null&&(c.f&q)===0&&(u.f^=q)}for(n=0;n<l;n++)if(i=t[n],yt(i)&&rs(i),i.wv>r.wv)return!0}(!s||S!==null&&!se)&&x(r,$)}return!1}function ws(r,e,t=!0){var s=r.reactions;if(s!==null&&!Q?.includes(r))for(var n=0;n<s.length;n++){var i=s[n];(i.f&M)!==0?ws(i,e,!1):e===i&&(t?x(i,B):(i.f&$)!==0&&x(i,ge),ie(i))}}function ys(r){var e=U,t=N,s=F,n=k,i=se,o=Q,a=P,l=J,u=ve,c=r.f;U=null,N=0,F=null,se=(c&q)!==0&&(J||!$e||k===null),k=(c&(Y|Ue))===0?r:null,Q=null,or(r.ctx),J=!1,ve=++Qe,r.ac!==null&&(r.ac.abort(Vr),r.ac=null);try{r.f|=$t;var h=(0,r.fn)(),d=r.deps;if(U!==null){var f;if(vt(r,N),d!==null&&N>0)for(d.length=N+U.length,f=0;f<U.length;f++)d[N+f]=U[f];else r.deps=d=U;if(!se||(c&M)!==0&&r.reactions!==null)for(f=N;f<d.length;f++)(d[f].reactions??=[]).push(r)}else d!==null&&N<d.length&&(vt(r,N),d.length=N);if(pt()&&F!==null&&!J&&d!==null&&(r.f&(M|ge|B))===0)for(f=0;f<F.length;f++)ws(F[f],r);return n!==null&&n!==r&&(Qe++,F!==null&&(s===null?s=F:s.push(...F))),(r.f&ct)!==0&&(r.f^=ct),h}catch(v){return hn(v)}finally{r.f^=$t,U=e,N=t,F=s,k=n,se=i,Q=o,or(a),J=l,ve=u}}function Cn(r,e){let t=e.reactions;if(t!==null){var s=Fs.call(t,r);if(s!==-1){var n=t.length-1;n===0?t=e.reactions=null:(t[s]=t[n],t.pop())}}t===null&&(e.f&M)!==0&&(U===null||!U.includes(e))&&(x(e,ge),(e.f&(q|ut))===0&&(e.f^=ut),ts(e),vt(e,0))}function vt(r,e){var t=r.deps;if(t!==null)for(var s=e;s<t.length;s++)Cn(r,t[s])}function He(r){var e=r.f;if((e&Ze)===0){x(r,$);var t=S,s=$e;S=r,$e=!0;try{(e&Xe)!==0?On(r):ds(r),hs(r);var n=ys(r);r.teardown=typeof n=="function"?n:null,r.wv=ft;var i;sr&&ln&&(r.f&B)!==0&&r.deps}finally{$e=s,S=t}}}function ne(r){var e=r.f,t=(e&M)!==0;if(k!==null&&!J){var s=S!==null&&(S.f&Ze)!==0;if(!s&&!Q?.includes(r)){var n=k.deps;if((k.f&$t)!==0)r.rv<Qe&&(r.rv=Qe,U===null&&n!==null&&n[N]===r?N++:U===null?U=[r]:(!se||!U.includes(r))&&U.push(r));else{(k.deps??=[]).push(r);var i=r.reactions;i===null?r.reactions=[k]:i.includes(k)||i.push(k)}}}else if(t&&r.deps===null&&r.effects===null){var o=r,a=o.parent;a!==null&&(a.f&q)===0&&(o.f^=q)}if(De){if(fe.has(r))return fe.get(r);if(t){o=r;var l=o.v;return((o.f&$)!==0||ms(o))&&(l=Gt(o)),fe.set(o,l),l}}else if(t){if(o=r,xe?.has(o))return xe.get(o);yt(o)&&rs(o)}if((r.f&ct)!==0)throw r.v;return r.v}function ms(r){if(r.v===I)return!0;if(r.deps===null)return!1;for(const e of r.deps)if(fe.has(e)||(e.f&M)!==0&&ms(e))return!0;return!1}function bs(r){var e=J;try{return J=!0,r()}finally{J=e}}const In=-7169;function x(r,e){r.f=r.f&In|e}function Un(r){if(!(typeof r!="object"||!r||r instanceof EventTarget)){if(Je in r)Ut(r);else if(!Array.isArray(r))for(let e in r){const t=r[e];typeof t=="object"&&t&&Je in t&&Ut(t)}}}function Ut(r,e=new Set){if(typeof r=="object"&&r!==null&&!(r instanceof EventTarget)&&!e.has(r)){e.add(r),r instanceof Date&&r.getTime();for(let s in r)try{Ut(r[s],e)}catch{}const t=Wr(r);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const s=Ks(t);for(let n in s){const i=s[n].get;if(i)try{i.call(r)}catch{}}}}}const Ln=["touchstart","touchmove"];function Dn(r){return Ln.includes(r)}function Nn(r){var e=k,t=S;ae(null),Ce(null);try{return r()}finally{ae(e),Ce(t)}}const qn=new Set,fr=new Set;function Bn(r,e,t,s={}){function n(i){if(s.capture||We.call(e,i),!i.cancelBubble)return Nn(()=>t?.call(this,i))}return r.startsWith("pointer")||r.startsWith("touch")||r==="wheel"?fn(()=>{e.addEventListener(r,n,s)}):e.addEventListener(r,n,s),n}function Mn(r,e,t,s,n){var i={capture:s,passive:n},o=Bn(r,e,t,i);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&Sn(()=>{e.removeEventListener(r,o,i)})}function We(r){var e=this,t=e.ownerDocument,s=r.type,n=r.composedPath?.()||[],i=n[0]||r.target,o=0,a=r.__root;if(a){var l=n.indexOf(a);if(l!==-1&&(e===document||e===window)){r.__root=e;return}var u=n.indexOf(e);if(u===-1)return;l<=u&&(o=l)}if(i=n[o]||r.target,i!==e){At(r,"currentTarget",{configurable:!0,get(){return i||t}});var c=k,h=S;ae(null),Ce(null);try{for(var d,f=[];i!==null;){var v=i.assignedSlot||i.parentNode||i.host||null;try{var g=i["__"+s];if(g!=null&&(!i.disabled||r.target===i))if(Fr(g)){var[_,...m]=g;_.apply(i,[r,...m])}else g.call(i,r)}catch(E){d?f.push(E):d=E}if(r.cancelBubble||v===e||v===null)break;i=v}if(d){for(let E of f)queueMicrotask(()=>{throw E});throw d}}finally{r.__root=e,delete r.currentTarget,ae(c),Ce(h)}}}function Fn(r){var e=document.createElement("template");return e.innerHTML=r.replaceAll("<!>","<!---->"),e.content}function ks(r,e){var t=S;t.nodes_start===null&&(t.nodes_start=r,t.nodes_end=e)}function Yt(r,e){var t=(e&nn)!==0,s,n=!r.startsWith("<!>");return()=>{s===void 0&&(s=Fn(n?r:"<!>"+r),s=Qt(s));var i=t||is?document.importNode(s,!0):s.cloneNode(!0);return ks(i,i),i}}function Wn(){var r=document.createDocumentFragment(),e=document.createComment(""),t=Vt();return r.append(e,t),ks(e,t),r}function lt(r,e){r!==null&&r.before(e)}function Kn(r,e){return zn(r,e)}const we=new Map;function zn(r,{target:e,anchor:t,props:s={},events:n,context:i,intro:o=!0}){yn();var a=new Set,l=h=>{for(var d=0;d<h.length;d++){var f=h[d];if(!a.has(f)){a.add(f);var v=Dn(f);e.addEventListener(f,We,{passive:v});var g=we.get(f);g===void 0?(document.addEventListener(f,We,{passive:v}),we.set(f,1)):we.set(f,g+1)}}};l(Ws(qn)),fr.add(l);var u=void 0,c=Tn(()=>{var h=t??e.appendChild(Vt());return It(()=>{if(i){Yr({});var d=P;d.c=i}n&&(s.$$events=n),u=r(h,s)||{},i&&Xr()}),()=>{for(var d of a){e.removeEventListener(d,We);var f=we.get(d);--f===0?(document.removeEventListener(d,We),we.delete(d)):we.set(d,f)}fr.delete(l),h!==t&&h.parentNode?.removeChild(h)}});return Jn.set(u,c),u}let Jn=new WeakMap;function Hn(r,e,t=!1){var s=r,n=null,i=null,o=I,a=t?Jt:0,l=!1;const u=(f,v=!0)=>{l=!0,d(v,f)};var c=null;function h(){c!==null&&(c.lastChild.remove(),s.before(c),c=null);var f=o?n:i,v=o?i:n;f&&Rn(f),v&&vs(v,()=>{o?i=null:n=null})}const d=(f,v)=>{if(o!==(o=f)){var g=bn(),_=s;if(g&&(c=document.createDocumentFragment(),c.append(_=Vt())),o?n??=v&&It(()=>v(_)):i??=v&&It(()=>v(_)),g){var m=z,E=o?n:i,p=o?i:n;E&&m.skipped_effects.delete(E),p&&m.skipped_effects.add(p),m.add_callback(h)}else h()}};jn(()=>{l=!1,e(u),l||d(null,null)},a)}function Gn(r=!1){const e=P,t=e.l.u;if(!t)return;let s=()=>Un(e.s);if(r){let n=0,i={};const o=vn(()=>{let a=!1;const l=e.s;for(const u in l)l[u]!==i[u]&&(i[u]=l[u],a=!0);return a&&n++,n});s=()=>ne(o)}t.b.length&&En(()=>{vr(e,s),Rt(t.b)}),Ct(()=>{const n=bs(()=>t.m.map(Hs));return()=>{for(const i of n)typeof i=="function"&&i()}}),t.a.length&&Ct(()=>{vr(e,s),Rt(t.a)})}function vr(r,e){if(r.l.s)for(const t of r.l.s)ne(t);e()}function Vn(r){P===null&&Qs(),et&&P.l!==null?Qn(P).m.push(r):Ct(()=>{const e=bs(r);if(typeof e=="function")return e})}function Qn(r){var e=r.l;return e.u??={a:[],b:[],m:[]}}const Yn="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Yn);un();const Xn="modulepreload",Zn=function(r,e){return new URL(r,e).href},_r={},tt=function(e,t,s){let n=Promise.resolve();if(t&&t.length>0){let u=function(c){return Promise.all(c.map(h=>Promise.resolve(h).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};const o=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),l=a?.nonce||a?.getAttribute("nonce");n=u(t.map(c=>{if(c=Zn(c,s),c in _r)return;_r[c]=!0;const h=c.endsWith(".css"),d=h?'[rel="stylesheet"]':"";if(!!s)for(let g=o.length-1;g>=0;g--){const _=o[g];if(_.href===c&&(!h||_.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${d}`))return;const v=document.createElement("link");if(v.rel=h?"stylesheet":Xn,h||(v.as="script"),v.crossOrigin="",v.href=c,l&&v.setAttribute("nonce",l),document.head.appendChild(v),h)return new Promise((g,_)=>{v.addEventListener("load",g),v.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return n.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})},ei=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>tt(async()=>{const{default:s}=await Promise.resolve().then(()=>Ne);return{default:s}},void 0,import.meta.url).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)};class Xt extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class ti extends Xt{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class gr extends Xt{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class pr extends Xt{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Lt;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(Lt||(Lt={}));var ri=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{u(s.next(c))}catch(h){o(h)}}function l(c){try{u(s.throw(c))}catch(h){o(h)}}function u(c){c.done?i(c.value):n(c.value).then(a,l)}u((s=s.apply(r,e||[])).next())})};class si{constructor(e,{headers:t={},customFetch:s,region:n=Lt.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=ei(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return ri(this,void 0,void 0,function*(){try{const{headers:n,method:i,body:o}=t;let a={},{region:l}=t;l||(l=this.region);const u=new URL(`${this.url}/${e}`);l&&l!=="any"&&(a["x-region"]=l,u.searchParams.set("forceFunctionRegion",l));let c;o&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",c=o):typeof o=="string"?(a["Content-Type"]="text/plain",c=o):typeof FormData<"u"&&o instanceof FormData?c=o:(a["Content-Type"]="application/json",c=JSON.stringify(o)));const h=yield this.fetch(u.toString(),{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),n),body:c}).catch(g=>{throw new ti(g)}),d=h.headers.get("x-relay-error");if(d&&d==="true")throw new gr(h);if(!h.ok)throw new pr(h);let f=((s=h.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),v;return f==="application/json"?v=yield h.json():f==="application/octet-stream"?v=yield h.blob():f==="text/event-stream"?v=h:f==="multipart/form-data"?v=yield h.formData():v=yield h.text(),{data:v,error:null,response:h}}catch(n){return{data:null,error:n,response:n instanceof pr||n instanceof gr?n.context:void 0}}})}}function ni(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function ii(r){if(Object.prototype.hasOwnProperty.call(r,"__esModule"))return r;var e=r.default;if(typeof e=="function"){var t=function s(){var n=!1;try{n=this instanceof s}catch{}return n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(s){var n=Object.getOwnPropertyDescriptor(r,s);Object.defineProperty(t,s,n.get?n:{enumerable:!0,get:function(){return r[s]}})}),t}var A={},ye={},me={},be={},ke={},Se={},oi=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Ie=oi();const ai=Ie.fetch,Ss=Ie.fetch.bind(Ie),Es=Ie.Headers,li=Ie.Request,ui=Ie.Response,Ne=Object.freeze(Object.defineProperty({__proto__:null,Headers:Es,Request:li,Response:ui,default:Ss,fetch:ai},Symbol.toStringTag,{value:"Module"})),ci=ii(Ne);var nt={},wr;function Ts(){if(wr)return nt;wr=1,Object.defineProperty(nt,"__esModule",{value:!0});class r extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return nt.default=r,nt}var yr;function js(){if(yr)return Se;yr=1;var r=Se&&Se.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Se,"__esModule",{value:!0});const e=r(ci),t=r(Ts());class s{constructor(i){this.shouldThrowOnError=!1,this.method=i.method,this.url=i.url,this.headers=i.headers,this.schema=i.schema,this.body=i.body,this.shouldThrowOnError=i.shouldThrowOnError,this.signal=i.signal,this.isMaybeSingle=i.isMaybeSingle,i.fetch?this.fetch=i.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(i,o){return this.headers=Object.assign({},this.headers),this.headers[i]=o,this}then(i,o){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const a=this.fetch;let l=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async u=>{var c,h,d;let f=null,v=null,g=null,_=u.status,m=u.statusText;if(u.ok){if(this.method!=="HEAD"){const j=await u.text();j===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?v=j:v=JSON.parse(j))}const p=(c=this.headers.Prefer)===null||c===void 0?void 0:c.match(/count=(exact|planned|estimated)/),b=(h=u.headers.get("content-range"))===null||h===void 0?void 0:h.split("/");p&&b&&b.length>1&&(g=parseInt(b[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(v)&&(v.length>1?(f={code:"PGRST116",details:`Results contain ${v.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},v=null,g=null,_=406,m="Not Acceptable"):v.length===1?v=v[0]:v=null)}else{const p=await u.text();try{f=JSON.parse(p),Array.isArray(f)&&u.status===404&&(v=[],f=null,_=200,m="OK")}catch{u.status===404&&p===""?(_=204,m="No Content"):f={message:p}}if(f&&this.isMaybeSingle&&(!((d=f?.details)===null||d===void 0)&&d.includes("0 rows"))&&(f=null,_=200,m="OK"),f&&this.shouldThrowOnError)throw new t.default(f)}return{error:f,data:v,count:g,status:_,statusText:m}});return this.shouldThrowOnError||(l=l.catch(u=>{var c,h,d;return{error:{message:`${(c=u?.name)!==null&&c!==void 0?c:"FetchError"}: ${u?.message}`,details:`${(h=u?.stack)!==null&&h!==void 0?h:""}`,hint:"",code:`${(d=u?.code)!==null&&d!==void 0?d:""}`},data:null,count:null,status:0,statusText:""}})),l.then(i,o)}returns(){return this}overrideTypes(){return this}}return Se.default=s,Se}var mr;function Os(){if(mr)return ke;mr=1;var r=ke&&ke.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(ke,"__esModule",{value:!0});const e=r(js());class t extends e.default{select(n){let i=!1;const o=(n??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",o),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(n,{ascending:i=!0,nullsFirst:o,foreignTable:a,referencedTable:l=a}={}){const u=l?`${l}.order`:"order",c=this.url.searchParams.get(u);return this.url.searchParams.set(u,`${c?`${c},`:""}${n}.${i?"asc":"desc"}${o===void 0?"":o?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:i,referencedTable:o=i}={}){const a=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(a,`${n}`),this}range(n,i,{foreignTable:o,referencedTable:a=o}={}){const l=typeof a>"u"?"offset":`${a}.offset`,u=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(l,`${n}`),this.url.searchParams.set(u,`${i-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:n=!1,verbose:i=!1,settings:o=!1,buffers:a=!1,wal:l=!1,format:u="text"}={}){var c;const h=[n?"analyze":null,i?"verbose":null,o?"settings":null,a?"buffers":null,l?"wal":null].filter(Boolean).join("|"),d=(c=this.headers.Accept)!==null&&c!==void 0?c:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${u}; for="${d}"; options=${h};`,u==="json"?this:this}rollback(){var n;return((n=this.headers.Prefer)!==null&&n!==void 0?n:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return ke.default=t,ke}var br;function Zt(){if(br)return be;br=1;var r=be&&be.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(be,"__esModule",{value:!0});const e=r(Os());class t extends e.default{eq(n,i){return this.url.searchParams.append(n,`eq.${i}`),this}neq(n,i){return this.url.searchParams.append(n,`neq.${i}`),this}gt(n,i){return this.url.searchParams.append(n,`gt.${i}`),this}gte(n,i){return this.url.searchParams.append(n,`gte.${i}`),this}lt(n,i){return this.url.searchParams.append(n,`lt.${i}`),this}lte(n,i){return this.url.searchParams.append(n,`lte.${i}`),this}like(n,i){return this.url.searchParams.append(n,`like.${i}`),this}likeAllOf(n,i){return this.url.searchParams.append(n,`like(all).{${i.join(",")}}`),this}likeAnyOf(n,i){return this.url.searchParams.append(n,`like(any).{${i.join(",")}}`),this}ilike(n,i){return this.url.searchParams.append(n,`ilike.${i}`),this}ilikeAllOf(n,i){return this.url.searchParams.append(n,`ilike(all).{${i.join(",")}}`),this}ilikeAnyOf(n,i){return this.url.searchParams.append(n,`ilike(any).{${i.join(",")}}`),this}is(n,i){return this.url.searchParams.append(n,`is.${i}`),this}in(n,i){const o=Array.from(new Set(i)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(n,`in.(${o})`),this}contains(n,i){return typeof i=="string"?this.url.searchParams.append(n,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(n,`cs.{${i.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(i)}`),this}containedBy(n,i){return typeof i=="string"?this.url.searchParams.append(n,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(n,`cd.{${i.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(i)}`),this}rangeGt(n,i){return this.url.searchParams.append(n,`sr.${i}`),this}rangeGte(n,i){return this.url.searchParams.append(n,`nxl.${i}`),this}rangeLt(n,i){return this.url.searchParams.append(n,`sl.${i}`),this}rangeLte(n,i){return this.url.searchParams.append(n,`nxr.${i}`),this}rangeAdjacent(n,i){return this.url.searchParams.append(n,`adj.${i}`),this}overlaps(n,i){return typeof i=="string"?this.url.searchParams.append(n,`ov.${i}`):this.url.searchParams.append(n,`ov.{${i.join(",")}}`),this}textSearch(n,i,{config:o,type:a}={}){let l="";a==="plain"?l="pl":a==="phrase"?l="ph":a==="websearch"&&(l="w");const u=o===void 0?"":`(${o})`;return this.url.searchParams.append(n,`${l}fts${u}.${i}`),this}match(n){return Object.entries(n).forEach(([i,o])=>{this.url.searchParams.append(i,`eq.${o}`)}),this}not(n,i,o){return this.url.searchParams.append(n,`not.${i}.${o}`),this}or(n,{foreignTable:i,referencedTable:o=i}={}){const a=o?`${o}.or`:"or";return this.url.searchParams.append(a,`(${n})`),this}filter(n,i,o){return this.url.searchParams.append(n,`${i}.${o}`),this}}return be.default=t,be}var kr;function Ps(){if(kr)return me;kr=1;var r=me&&me.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(me,"__esModule",{value:!0});const e=r(Zt());class t{constructor(n,{headers:i={},schema:o,fetch:a}){this.url=n,this.headers=i,this.schema=o,this.fetch=a}select(n,{head:i=!1,count:o}={}){const a=i?"HEAD":"GET";let l=!1;const u=(n??"*").split("").map(c=>/\s/.test(c)&&!l?"":(c==='"'&&(l=!l),c)).join("");return this.url.searchParams.set("select",u),o&&(this.headers.Prefer=`count=${o}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(n,{count:i,defaultToNull:o=!0}={}){const a="POST",l=[];if(this.headers.Prefer&&l.push(this.headers.Prefer),i&&l.push(`count=${i}`),o||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(n)){const u=n.reduce((c,h)=>c.concat(Object.keys(h)),[]);if(u.length>0){const c=[...new Set(u)].map(h=>`"${h}"`);this.url.searchParams.set("columns",c.join(","))}}return new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}upsert(n,{onConflict:i,ignoreDuplicates:o=!1,count:a,defaultToNull:l=!0}={}){const u="POST",c=[`resolution=${o?"ignore":"merge"}-duplicates`];if(i!==void 0&&this.url.searchParams.set("on_conflict",i),this.headers.Prefer&&c.push(this.headers.Prefer),a&&c.push(`count=${a}`),l||c.push("missing=default"),this.headers.Prefer=c.join(","),Array.isArray(n)){const h=n.reduce((d,f)=>d.concat(Object.keys(f)),[]);if(h.length>0){const d=[...new Set(h)].map(f=>`"${f}"`);this.url.searchParams.set("columns",d.join(","))}}return new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}update(n,{count:i}={}){const o="PATCH",a=[];return this.headers.Prefer&&a.push(this.headers.Prefer),i&&a.push(`count=${i}`),this.headers.Prefer=a.join(","),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}delete({count:n}={}){const i="DELETE",o=[];return n&&o.push(`count=${n}`),this.headers.Prefer&&o.unshift(this.headers.Prefer),this.headers.Prefer=o.join(","),new e.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return me.default=t,me}var qe={},Be={},Sr;function hi(){return Sr||(Sr=1,Object.defineProperty(Be,"__esModule",{value:!0}),Be.version=void 0,Be.version="0.0.0-automated"),Be}var Er;function di(){if(Er)return qe;Er=1,Object.defineProperty(qe,"__esModule",{value:!0}),qe.DEFAULT_HEADERS=void 0;const r=hi();return qe.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${r.version}`},qe}var Tr;function fi(){if(Tr)return ye;Tr=1;var r=ye&&ye.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(ye,"__esModule",{value:!0});const e=r(Ps()),t=r(Zt()),s=di();class n{constructor(o,{headers:a={},schema:l,fetch:u}={}){this.url=o,this.headers=Object.assign(Object.assign({},s.DEFAULT_HEADERS),a),this.schemaName=l,this.fetch=u}from(o){const a=new URL(`${this.url}/${o}`);return new e.default(a,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(o){return new n(this.url,{headers:this.headers,schema:o,fetch:this.fetch})}rpc(o,a={},{head:l=!1,get:u=!1,count:c}={}){let h;const d=new URL(`${this.url}/rpc/${o}`);let f;l||u?(h=l?"HEAD":"GET",Object.entries(a).filter(([g,_])=>_!==void 0).map(([g,_])=>[g,Array.isArray(_)?`{${_.join(",")}}`:`${_}`]).forEach(([g,_])=>{d.searchParams.append(g,_)})):(h="POST",f=a);const v=Object.assign({},this.headers);return c&&(v.Prefer=`count=${c}`),new t.default({method:h,url:d,headers:v,schema:this.schemaName,body:f,fetch:this.fetch,allowEmpty:!1})}}return ye.default=n,ye}var jr;function vi(){if(jr)return A;jr=1;var r=A&&A.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(A,"__esModule",{value:!0}),A.PostgrestError=A.PostgrestBuilder=A.PostgrestTransformBuilder=A.PostgrestFilterBuilder=A.PostgrestQueryBuilder=A.PostgrestClient=void 0;const e=r(fi());A.PostgrestClient=e.default;const t=r(Ps());A.PostgrestQueryBuilder=t.default;const s=r(Zt());A.PostgrestFilterBuilder=s.default;const n=r(Os());A.PostgrestTransformBuilder=n.default;const i=r(js());A.PostgrestBuilder=i.default;const o=r(Ts());return A.PostgrestError=o.default,A.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:s.default,PostgrestTransformBuilder:n.default,PostgrestBuilder:i.default,PostgrestError:o.default},A}var _i=vi();const gi=ni(_i),{PostgrestClient:pi,PostgrestQueryBuilder:ha,PostgrestFilterBuilder:da,PostgrestTransformBuilder:fa,PostgrestBuilder:va,PostgrestError:_a}=gi;function wi(){if(typeof WebSocket<"u")return WebSocket;if(typeof global.WebSocket<"u")return global.WebSocket;if(typeof window.WebSocket<"u")return window.WebSocket;if(typeof self.WebSocket<"u")return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}const yi=wi(),mi="2.11.15",bi=`realtime-js/${mi}`,ki="1.0.0",As=1e4,Si=1e3;var Ge;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(Ge||(Ge={}));var C;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(C||(C={}));var K;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(K||(K={}));var Dt;(function(r){r.websocket="websocket"})(Dt||(Dt={}));var de;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(de||(de={}));class Ei{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const n=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=s.decode(e.slice(o,o+n));o=o+n;const l=s.decode(e.slice(o,o+i));o=o+i;const u=JSON.parse(s.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:l,payload:u}}}class Rs{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var T;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(T||(T={}));const Or=(r,e,t={})=>{var s;const n=(s=t.skipTypes)!==null&&s!==void 0?s:[];return Object.keys(e).reduce((i,o)=>(i[o]=Ti(o,r,e,n),i),{})},Ti=(r,e,t,s)=>{const n=e.find(a=>a.name===r),i=n?.type,o=t[r];return i&&!s.includes(i)?$s(i,o):Nt(o)},$s=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return Ai(e,t)}switch(r){case T.bool:return ji(e);case T.float4:case T.float8:case T.int2:case T.int4:case T.int8:case T.numeric:case T.oid:return Oi(e);case T.json:case T.jsonb:return Pi(e);case T.timestamp:return Ri(e);case T.abstime:case T.date:case T.daterange:case T.int4range:case T.int8range:case T.money:case T.reltime:case T.text:case T.time:case T.timestamptz:case T.timetz:case T.tsrange:case T.tstzrange:return Nt(e);default:return Nt(e)}},Nt=r=>r,ji=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},Oi=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},Pi=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},Ai=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,s=r[t];if(r[0]==="{"&&s==="}"){let i;const o=r.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>$s(e,a))}return r},Ri=r=>typeof r=="string"?r.replace(" ","T"):r,xs=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class kt{constructor(e,t,s={},n=As){this.channel=e,this.event=t,this.payload=s,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Pr;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(Pr||(Pr={}));class Ve{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},n=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ve.syncState(this.state,n,i,o),this.pendingDiffs.forEach(l=>{this.state=Ve.syncDiff(this.state,l,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(s.diff,{},n=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=Ve.syncDiff(this.state,n,i,o),a())}),this.onJoin((n,i,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:o})}),this.onLeave((n,i,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,n){const i=this.cloneDeep(e),o=this.transformState(t),a={},l={};return this.map(i,(u,c)=>{o[u]||(l[u]=c)}),this.map(o,(u,c)=>{const h=i[u];if(h){const d=c.map(_=>_.presence_ref),f=h.map(_=>_.presence_ref),v=c.filter(_=>f.indexOf(_.presence_ref)<0),g=h.filter(_=>d.indexOf(_.presence_ref)<0);v.length>0&&(a[u]=v),g.length>0&&(l[u]=g)}else a[u]=c}),this.syncDiff(i,{joins:a,leaves:l},s,n)}static syncDiff(e,t,s,n){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),n||(n=()=>{}),this.map(i,(a,l)=>{var u;const c=(u=e[a])!==null&&u!==void 0?u:[];if(e[a]=this.cloneDeep(l),c.length>0){const h=e[a].map(f=>f.presence_ref),d=c.filter(f=>h.indexOf(f.presence_ref)<0);e[a].unshift(...d)}s(a,c,l)}),this.map(o,(a,l)=>{let u=e[a];if(!u)return;const c=l.map(h=>h.presence_ref);u=u.filter(h=>c.indexOf(h.presence_ref)<0),e[a]=u,n(a,u,l),u.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const n=e[s];return"metas"in n?t[s]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[s]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Ar;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(Ar||(Ar={}));var Rr;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(Rr||(Rr={}));var V;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(V||(V={}));class er{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=C.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new kt(this,K.join,this.params,this.timeout),this.rejoinTimer=new Rs(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=C.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=C.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=C.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=C.errored,this.rejoinTimer.scheduleTimeout())}),this._on(K.reply,{},(n,i)=>{this._trigger(this._replyEventName(i),n)}),this.presence=new Ve(this),this.broadcastEndpointURL=xs(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,n;if(this.socket.isConnected()||this.socket.connect(),this.state==C.closed){const{config:{broadcast:i,presence:o,private:a}}=this.params;this._onError(c=>e?.(V.CHANNEL_ERROR,c)),this._onClose(()=>e?.(V.CLOSED));const l={},u={broadcast:i,presence:o,postgres_changes:(n=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(c=>c.filter))!==null&&n!==void 0?n:[],private:a};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:u},l)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:c})=>{var h;if(this.socket.setAuth(),c===void 0){e?.(V.SUBSCRIBED);return}else{const d=this.bindings.postgres_changes,f=(h=d?.length)!==null&&h!==void 0?h:0,v=[];for(let g=0;g<f;g++){const _=d[g],{filter:{event:m,schema:E,table:p,filter:b}}=_,j=c&&c[g];if(j&&j.event===m&&j.schema===E&&j.table===p&&j.filter===b)v.push(Object.assign(Object.assign({},_),{id:j.id}));else{this.unsubscribe(),this.state=C.errored,e?.(V.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=v,e&&e(V.SUBSCRIBED);return}}).receive("error",c=>{this.state=C.errored,e?.(V.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(c).join(", ")||"error")))}).receive("timeout",()=>{e?.(V.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,n;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:o}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((n=u.body)===null||n===void 0?void 0:n.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,a,l;const u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("error",()=>i("error")),u.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=C.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(K.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(n=>{s=new kt(this,K.leave,{},e),s.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,t,s){const n=new AbortController,i=setTimeout(()=>n.abort(),s),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(i),o}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new kt(this,e,t,s);return this._canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var n,i;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:u,join:c}=K;if(s&&[a,l,u,c].indexOf(o)>=0&&s!==this._joinRef())return;let d=this._onMessage(o,t,s);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(f=>{var v,g,_;return((v=f.filter)===null||v===void 0?void 0:v.event)==="*"||((_=(g=f.filter)===null||g===void 0?void 0:g.event)===null||_===void 0?void 0:_.toLocaleLowerCase())===o}).map(f=>f.callback(d,s)):(i=this.bindings[o])===null||i===void 0||i.filter(f=>{var v,g,_,m,E,p;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in f){const b=f.id,j=(v=f.filter)===null||v===void 0?void 0:v.event;return b&&((g=t.ids)===null||g===void 0?void 0:g.includes(b))&&(j==="*"||j?.toLocaleLowerCase()===((_=t.data)===null||_===void 0?void 0:_.type.toLocaleLowerCase()))}else{const b=(E=(m=f?.filter)===null||m===void 0?void 0:m.event)===null||E===void 0?void 0:E.toLocaleLowerCase();return b==="*"||b===((p=t?.event)===null||p===void 0?void 0:p.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===o}).map(f=>{if(typeof d=="object"&&"ids"in d){const v=d.data,{schema:g,table:_,commit_timestamp:m,type:E,errors:p}=v;d=Object.assign(Object.assign({},{schema:g,table:_,commit_timestamp:m,eventType:E,new:{},old:{},errors:p}),this._getPayloadRecords(v))}f.callback(d,s)})}_isClosed(){return this.state===C.closed}_isJoined(){return this.state===C.joined}_isJoining(){return this.state===C.joining}_isLeaving(){return this.state===C.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const n=e.toLocaleLowerCase(),i={type:n,filter:t,callback:s};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===s&&er.isEqual(n.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(K.close,{},e)}_onError(e){this._on(K.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=C.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Or(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Or(e.columns,e.old_record)),t}}const $r=()=>{},$i=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class xi{constructor(e,t){var s;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=As,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=$r,this.ref=0,this.logger=$r,this.conn=null,this.sendBuffer=[],this.serializer=new Ei,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let o;return i?o=i:typeof fetch>"u"?o=(...a)=>tt(async()=>{const{default:l}=await Promise.resolve().then(()=>Ne);return{default:l}},void 0,import.meta.url).then(({default:l})=>l(...a)):o=fetch,(...a)=>o(...a)},this.endPoint=`${e}/${Dt.websocket}`,this.httpEndpoint=xs(e),t?.transport?this.transport=t.transport:this.transport=null,t?.params&&(this.params=t.params),t?.timeout&&(this.timeout=t.timeout),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),t?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const n=(s=t?.params)===null||s===void 0?void 0:s.apikey;if(n&&(this.accessTokenValue=n,this.apiKey=n),this.reconnectAfterMs=t?.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t?.encode?t.encode:(i,o)=>o(JSON.stringify(i)),this.decode=t?.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Rs(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t?.fetch),t?.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=t?.worker||!1,this.workerUrl=t?.workerUrl}this.accessToken=t?.accessToken||null}connect(){if(!this.conn){if(this.transport||(this.transport=yi),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:ki}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(s=>s.teardown()))}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case Ge.connecting:return de.Connecting;case Ge.open:return de.Open;case Ge.closing:return de.Closing;default:return de.Closed}}isConnected(){return this.connectionState()===de.Open}channel(e,t={config:{}}){const s=`realtime:${e}`,n=this.getChannels().find(i=>i.topic===s);if(n)return n;{const i=new er(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){const{topic:t,event:s,payload:n,ref:i}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${t} ${s} (${i})`,n),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(s=>{const n={access_token:t,version:bi};t&&s.updateJoinPayload(n),s.joinedOnce&&s._isJoined()&&s._push(K.access_token,{access_token:t})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(Si,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:s,event:n,payload:i,ref:o}=t;s==="phoenix"&&n==="phx_reply"&&this.heartbeatCallback(t.payload.status=="ok"?"ok":"error"),o&&o===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${s} ${n} ${o&&"("+o+")"||""}`,i),Array.from(this.channels).filter(a=>a._isMember(s)).forEach(a=>a._trigger(n,i,o)),this.stateChangeCallbacks.message.forEach(a=>a(t))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(K.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${s}${n}`}_workerObjectUrl(e){let t;if(e)t=e;else{const s=new Blob([$i],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}}class tr extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function R(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class Ci extends tr{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class qt extends tr{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Ii=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{u(s.next(c))}catch(h){o(h)}}function l(c){try{u(s.throw(c))}catch(h){o(h)}}function u(c){c.done?i(c.value):n(c.value).then(a,l)}u((s=s.apply(r,e||[])).next())})};const Cs=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>tt(async()=>{const{default:s}=await Promise.resolve().then(()=>Ne);return{default:s}},void 0,import.meta.url).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Ui=()=>Ii(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield tt(()=>Promise.resolve().then(()=>Ne),void 0,import.meta.url)).Response:Response}),Bt=r=>{if(Array.isArray(r))return r.map(t=>Bt(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,s])=>{const n=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[n]=Bt(s)}),e};var pe=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{u(s.next(c))}catch(h){o(h)}}function l(c){try{u(s.throw(c))}catch(h){o(h)}}function u(c){c.done?i(c.value):n(c.value).then(a,l)}u((s=s.apply(r,e||[])).next())})};const St=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Li=(r,e,t)=>pe(void 0,void 0,void 0,function*(){const s=yield Ui();r instanceof s&&!t?.noResolveJson?r.json().then(n=>{e(new Ci(St(n),r.status||500))}).catch(n=>{e(new qt(St(n),n))}):e(new qt(St(r),r))}),Di=(r,e,t,s)=>{const n={method:r,headers:e?.headers||{}};return r==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json"},e?.headers),s&&(n.body=JSON.stringify(s)),Object.assign(Object.assign({},n),t))};function rt(r,e,t,s,n,i){return pe(this,void 0,void 0,function*(){return new Promise((o,a)=>{r(t,Di(e,s,n,i)).then(l=>{if(!l.ok)throw l;return s?.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>Li(l,a,s))})})}function _t(r,e,t,s){return pe(this,void 0,void 0,function*(){return rt(r,"GET",e,t,s)})}function te(r,e,t,s,n){return pe(this,void 0,void 0,function*(){return rt(r,"POST",e,s,n,t)})}function Ni(r,e,t,s,n){return pe(this,void 0,void 0,function*(){return rt(r,"PUT",e,s,n,t)})}function qi(r,e,t,s){return pe(this,void 0,void 0,function*(){return rt(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function Is(r,e,t,s,n){return pe(this,void 0,void 0,function*(){return rt(r,"DELETE",e,s,n,t)})}var L=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{u(s.next(c))}catch(h){o(h)}}function l(c){try{u(s.throw(c))}catch(h){o(h)}}function u(c){c.done?i(c.value):n(c.value).then(a,l)}u((s=s.apply(r,e||[])).next())})};const Bi={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},xr={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Mi{constructor(e,t={},s,n){this.url=e,this.headers=t,this.bucketId=s,this.fetch=Cs(n)}uploadOrUpdate(e,t,s,n){return L(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},xr),n);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&s instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",this.encodeMetadata(l)),i.append("",s)):typeof FormData<"u"&&s instanceof FormData?(i=s,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",this.encodeMetadata(l))):(i=s,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),n?.headers&&(a=Object.assign(Object.assign({},a),n.headers));const u=this._removeEmptyFolders(t),c=this._getFinalPath(u),h=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:e,body:i,headers:a},o?.duplex?{duplex:o.duplex}:{})),d=yield h.json();return h.ok?{data:{path:u,id:d.Id,fullPath:d.Key},error:null}:{data:null,error:d}}catch(i){if(R(i))return{data:null,error:i};throw i}})}upload(e,t,s){return L(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,n){return L(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let l;const u=Object.assign({upsert:xr.upsert},n),c=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&s instanceof Blob?(l=new FormData,l.append("cacheControl",u.cacheControl),l.append("",s)):typeof FormData<"u"&&s instanceof FormData?(l=s,l.append("cacheControl",u.cacheControl)):(l=s,c["cache-control"]=`max-age=${u.cacheControl}`,c["content-type"]=u.contentType);const h=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:c}),d=yield h.json();return h.ok?{data:{path:i,fullPath:d.Key},error:null}:{data:null,error:d}}catch(l){if(R(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return L(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const n=Object.assign({},this.headers);t?.upsert&&(n["x-upsert"]="true");const i=yield te(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:n}),o=new URL(this.url+i.url),a=o.searchParams.get("token");if(!a)throw new tr("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(s){if(R(s))return{data:null,error:s};throw s}})}update(e,t,s){return L(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return L(this,void 0,void 0,function*(){try{return{data:yield te(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s?.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(R(n))return{data:null,error:n};throw n}})}copy(e,t,s){return L(this,void 0,void 0,function*(){try{return{data:{path:(yield te(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(R(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,s){return L(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),i=yield te(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},s?.transform?{transform:s.transform}:{}),{headers:this.headers});const o=s?.download?`&download=${s.download===!0?"":s.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(n){if(R(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,s){return L(this,void 0,void 0,function*(){try{const n=yield te(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=s?.download?`&download=${s.download===!0?"":s.download}`:"";return{data:n.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(n){if(R(n))return{data:null,error:n};throw n}})}download(e,t){return L(this,void 0,void 0,function*(){const n=typeof t?.transform<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString(t?.transform||{}),o=i?`?${i}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield _t(this.fetch,`${this.url}/${n}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(R(a))return{data:null,error:a};throw a}})}info(e){return L(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const s=yield _t(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Bt(s),error:null}}catch(s){if(R(s))return{data:null,error:s};throw s}})}exists(e){return L(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield qi(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(R(s)&&s instanceof qt){const n=s.originalError;if([400,404].includes(n?.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),n=[],i=t?.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&n.push(i);const a=typeof t?.transform<"u"?"render/image":"object",l=this.transformOptsToQueryString(t?.transform||{});l!==""&&n.push(l);let u=n.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${s}${u}`)}}}remove(e){return L(this,void 0,void 0,function*(){try{return{data:yield Is(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(R(t))return{data:null,error:t};throw t}})}list(e,t,s){return L(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},Bi),t),{prefix:e||""});return{data:yield te(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},s),error:null}}catch(n){if(R(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Fi="2.7.1",Wi={"X-Client-Info":`storage-js/${Fi}`};var Ee=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{u(s.next(c))}catch(h){o(h)}}function l(c){try{u(s.throw(c))}catch(h){o(h)}}function u(c){c.done?i(c.value):n(c.value).then(a,l)}u((s=s.apply(r,e||[])).next())})};class Ki{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},Wi),t),this.fetch=Cs(s)}listBuckets(){return Ee(this,void 0,void 0,function*(){try{return{data:yield _t(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(R(e))return{data:null,error:e};throw e}})}getBucket(e){return Ee(this,void 0,void 0,function*(){try{return{data:yield _t(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(R(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Ee(this,void 0,void 0,function*(){try{return{data:yield te(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(R(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return Ee(this,void 0,void 0,function*(){try{return{data:yield Ni(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(R(s))return{data:null,error:s};throw s}})}emptyBucket(e){return Ee(this,void 0,void 0,function*(){try{return{data:yield te(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(R(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Ee(this,void 0,void 0,function*(){try{return{data:yield Is(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(R(t))return{data:null,error:t};throw t}})}}class zi extends Ki{constructor(e,t={},s){super(e,t,s)}from(e){return new Mi(this.url,this.headers,e,this.fetch)}}const Ji="2.51.0";let Ke="";typeof Deno<"u"?Ke="deno":typeof document<"u"?Ke="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ke="react-native":Ke="node";const Hi={"X-Client-Info":`supabase-js-${Ke}/${Ji}`},Gi={headers:Hi},Vi={schema:"public"},Qi={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Yi={};var Xi=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{u(s.next(c))}catch(h){o(h)}}function l(c){try{u(s.throw(c))}catch(h){o(h)}}function u(c){c.done?i(c.value):n(c.value).then(a,l)}u((s=s.apply(r,e||[])).next())})};const Zi=r=>{let e;return r?e=r:typeof fetch>"u"?e=Ss:e=fetch,(...t)=>e(...t)},eo=()=>typeof Headers>"u"?Es:Headers,to=(r,e,t)=>{const s=Zi(t),n=eo();return(i,o)=>Xi(void 0,void 0,void 0,function*(){var a;const l=(a=yield e())!==null&&a!==void 0?a:r;let u=new n(o?.headers);return u.has("apikey")||u.set("apikey",r),u.has("Authorization")||u.set("Authorization",`Bearer ${l}`),s(i,Object.assign(Object.assign({},o),{headers:u}))})};var ro=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{u(s.next(c))}catch(h){o(h)}}function l(c){try{u(s.throw(c))}catch(h){o(h)}}function u(c){c.done?i(c.value):n(c.value).then(a,l)}u((s=s.apply(r,e||[])).next())})};function so(r){return r.endsWith("/")?r:r+"/"}function no(r,e){var t,s;const{db:n,auth:i,realtime:o,global:a}=r,{db:l,auth:u,realtime:c,global:h}=e,d={db:Object.assign(Object.assign({},l),n),auth:Object.assign(Object.assign({},u),i),realtime:Object.assign(Object.assign({},c),o),global:Object.assign(Object.assign(Object.assign({},h),a),{headers:Object.assign(Object.assign({},(t=h?.headers)!==null&&t!==void 0?t:{}),(s=a?.headers)!==null&&s!==void 0?s:{})}),accessToken:()=>ro(this,void 0,void 0,function*(){return""})};return r.accessToken?d.accessToken=r.accessToken:delete d.accessToken,d}const Us="2.71.0",Ae=30*1e3,Mt=3,Et=Mt*Ae,io="http://localhost:9999",oo="supabase.auth.token",ao={"X-Client-Info":`gotrue-js/${Us}`},Ft="X-Supabase-Api-Version",Ls={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},lo=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,uo=10*60*1e3;class rr extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function w(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class co extends rr{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function ho(r){return w(r)&&r.name==="AuthApiError"}class Ds extends rr{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class le extends rr{constructor(e,t,s,n){super(e,s,n),this.name=t,this.status=s}}class ee extends le{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function fo(r){return w(r)&&r.name==="AuthSessionMissingError"}class it extends le{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class ot extends le{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class at extends le{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function vo(r){return w(r)&&r.name==="AuthImplicitGrantRedirectError"}class Cr extends le{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Wt extends le{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Tt(r){return w(r)&&r.name==="AuthRetryableFetchError"}class Ir extends le{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class Kt extends le{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const gt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Ur=` 	
\r=`.split(""),_o=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<Ur.length;e+=1)r[Ur[e].charCodeAt(0)]=-2;for(let e=0;e<gt.length;e+=1)r[gt[e].charCodeAt(0)]=e;return r})();function Lr(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(gt[s]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(gt[s]),e.queuedBits-=6}}function Ns(r,e,t){const s=_o[r];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function Dr(r){const e=[],t=o=>{e.push(String.fromCodePoint(o))},s={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=o=>{wo(o,s,t)};for(let o=0;o<r.length;o+=1)Ns(r.charCodeAt(o),n,i);return e.join("")}function go(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function po(r,e){for(let t=0;t<r.length;t+=1){let s=r.charCodeAt(t);if(s>55295&&s<=56319){const n=(s-55296)*1024&65535;s=(r.charCodeAt(t+1)-56320&65535|n)+65536,t+=1}go(s,e)}}function wo(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let s=1;s<6;s+=1)if((r>>7-s&1)===0){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function yo(r){const e=[],t={queue:0,queuedBits:0},s=n=>{e.push(n)};for(let n=0;n<r.length;n+=1)Ns(r.charCodeAt(n),t,s);return new Uint8Array(e)}function mo(r){const e=[];return po(r,t=>e.push(t)),new Uint8Array(e)}function bo(r){const e=[],t={queue:0,queuedBits:0},s=n=>{e.push(n)};return r.forEach(n=>Lr(n,t,s)),Lr(null,t,s),e.join("")}function ko(r){return Math.round(Date.now()/1e3)+r}function So(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const W=()=>typeof window<"u"&&typeof document<"u",ue={tested:!1,writable:!1},qs=()=>{if(!W())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ue.tested)return ue.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),ue.tested=!0,ue.writable=!0}catch{ue.tested=!0,ue.writable=!1}return ue.writable};function Eo(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,i)=>{e[i]=n})}catch{}return t.searchParams.forEach((s,n)=>{e[n]=s}),e}const Bs=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>tt(async()=>{const{default:s}=await Promise.resolve().then(()=>Ne);return{default:s}},void 0,import.meta.url).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},To=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",Re=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},ce=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Z=async(r,e)=>{await r.removeItem(e)};class mt{constructor(){this.promise=new mt.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}mt.promiseConstructor=Promise;function jt(r){const e=r.split(".");if(e.length!==3)throw new Kt("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!lo.test(e[s]))throw new Kt("JWT not in base64url format");return{header:JSON.parse(Dr(e[0])),payload:JSON.parse(Dr(e[1])),signature:yo(e[2]),raw:{header:e[0],payload:e[1]}}}async function jo(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function Oo(r,e){return new Promise((s,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await r(i);if(!e(i,null,o)){s(o);return}}catch(o){if(!e(i,o)){n(o);return}}})()})}function Po(r){return("0"+r.toString(16)).substr(-2)}function Ao(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let n="";for(let i=0;i<56;i++)n+=t.charAt(Math.floor(Math.random()*s));return n}return crypto.getRandomValues(e),Array.from(e,Po).join("")}async function Ro(r){const t=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(s);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}async function $o(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await Ro(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Te(r,e,t=!1){const s=Ao();let n=s;t&&(n+="/PASSWORD_RECOVERY"),await Re(r,`${e}-code-verifier`,n);const i=await $o(s);return[i,s===i?"plain":"s256"]}const xo=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Co(r){const e=r.headers.get(Ft);if(!e||!e.match(xo))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Io(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function Uo(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Lo=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function je(r){if(!Lo.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Ot(){const r={};return new Proxy(r,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const s=t.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}var Do=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t};const he=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),No=[502,503,504];async function Nr(r){var e;if(!To(r))throw new Wt(he(r),0);if(No.includes(r.status))throw new Wt(he(r),r.status);let t;try{t=await r.json()}catch(i){throw new Ds(he(i),i)}let s;const n=Co(r);if(n&&n.getTime()>=Ls["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new Ir(he(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new ee}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new Ir(he(t),r.status,t.weak_password.reasons);throw new co(he(t),r.status||500,s)}const qo=(r,e,t,s)=>{const n={method:r,headers:e?.headers||{}};return r==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),t))};async function y(r,e,t,s){var n;const i=Object.assign({},s?.headers);i[Ft]||(i[Ft]=Ls["2024-01-01"].name),s?.jwt&&(i.Authorization=`Bearer ${s.jwt}`);const o=(n=s?.query)!==null&&n!==void 0?n:{};s?.redirectTo&&(o.redirect_to=s.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await Bo(r,e,t+a,{headers:i,noResolveJson:s?.noResolveJson},{},s?.body);return s?.xform?s?.xform(l):{data:Object.assign({},l),error:null}}async function Bo(r,e,t,s,n,i){const o=qo(e,s,n,i);let a;try{a=await r(t,Object.assign({},o))}catch(l){throw console.error(l),new Wt(he(l),0)}if(a.ok||await Nr(a),s?.noResolveJson)return a;try{return await a.json()}catch(l){await Nr(l)}}function H(r){var e;let t=null;Ko(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=ko(r.expires_in)));const s=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:s},error:null}}function qr(r){const e=H(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=r.weak_password),e}function re(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function Mo(r){return{data:r,error:null}}function Fo(r){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i}=r,o=Do(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function Wo(r){return r}function Ko(r){return r.access_token&&r.refresh_token&&r.expires_in}const Pt=["global","local","others"];var zo=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t};class Jo{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=Bs(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=Pt[0]){if(Pt.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Pt.join(", ")}`);try{return await y(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(w(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await y(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:re})}catch(s){if(w(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=zo(e,["options"]),n=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(n.new_email=s?.newEmail,delete n.newEmail),await y(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:Fo,redirectTo:t?.redirectTo})}catch(t){if(w(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await y(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:re})}catch(t){if(w(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,n,i,o,a,l;try{const u={nextPage:null,lastPage:0,total:0},c=await y(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(i=(n=e?.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:Wo});if(c.error)throw c.error;const h=await c.json(),d=(o=c.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(l=(a=c.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(v=>{const g=parseInt(v.split(";")[0].split("=")[1].substring(0,1)),_=JSON.parse(v.split(";")[1].split("=")[1]);u[`${_}Page`]=g}),u.total=parseInt(d)),{data:Object.assign(Object.assign({},h),u),error:null}}catch(u){if(w(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){je(e);try{return await y(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:re})}catch(t){if(w(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){je(e);try{return await y(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:re})}catch(s){if(w(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){je(e);try{return await y(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:re})}catch(s){if(w(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){je(e.userId);try{const{data:t,error:s}=await y(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:s}}catch(t){if(w(t))return{data:null,error:t};throw t}}async _deleteFactor(e){je(e.userId),je(e.id);try{return{data:await y(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(w(t))return{data:null,error:t};throw t}}}function Br(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function Ho(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Oe={debug:!!(globalThis&&qs()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Ms extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Go extends Ms{}async function Vo(r,e,t){Oe.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),Oe.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async n=>{if(n){Oe.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,n.name);try{return await t()}finally{Oe.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,n.name)}}else{if(e===0)throw Oe.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new Go(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(Oe.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}Ho();const Qo={url:io,storageKey:oo,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:ao,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Mr(r,e,t){return await t()}const Pe={};class Ye{constructor(e){var t,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Ye.nextInstanceID,Ye.nextInstanceID+=1,this.instanceID>0&&W()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},Qo),e);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new Jo({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=Bs(n.fetch),this.lock=n.lock||Mr,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:W()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=Vo:this.lock=Mr,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(n.storage?this.storage=n.storage:qs()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Br(this.memoryStorage)),n.userStorage&&(this.userStorage=n.userStorage)):(this.memoryStorage={},this.storage=Br(this.memoryStorage)),W()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=Pe[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){Pe[this.storageKey]=Object.assign(Object.assign({},Pe[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=Pe[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Pe[this.storageKey]=Object.assign(Object.assign({},Pe[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Us}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=Eo(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),W()&&this.detectSessionInUrl&&s!=="none"){const{data:n,error:i}=await this._getSessionFromURL(t,s);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),vo(i)){const l=(e=i.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:a}=n;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return w(t)?{error:t}:{error:new Ds("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,n;try{const i=await y(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(n=e?.options)===null||n===void 0?void 0:n.captchaToken}},xform:H}),{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(i){if(w(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,s,n;try{let i;if("email"in e){const{email:c,password:h,options:d}=e;let f=null,v=null;this.flowType==="pkce"&&([f,v]=await Te(this.storage,this.storageKey)),i=await y(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:d?.emailRedirectTo,body:{email:c,password:h,data:(t=d?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:d?.captchaToken},code_challenge:f,code_challenge_method:v},xform:H})}else if("phone"in e){const{phone:c,password:h,options:d}=e;i=await y(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:c,password:h,data:(s=d?.data)!==null&&s!==void 0?s:{},channel:(n=d?.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:d?.captchaToken}},xform:H})}else throw new ot("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(i){if(w(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:o,options:a}=e;t=await y(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:qr})}else if("phone"in e){const{phone:i,password:o,options:a}=e;t=await y(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:qr})}else throw new ot("You must provide either an email or phone number and a password");const{data:s,error:n}=t;return n?{data:{user:null,session:null},error:n}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new it}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:n})}catch(t){if(w(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,n,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,s,n,i,o,a,l,u,c,h,d,f;let v,g;if("message"in e)v=e.message,g=e.signature;else{const{chain:_,wallet:m,statement:E,options:p}=e;let b;if(W())if(typeof m=="object")b=m;else{const O=window;if("solana"in O&&typeof O.solana=="object"&&("signIn"in O.solana&&typeof O.solana.signIn=="function"||"signMessage"in O.solana&&typeof O.solana.signMessage=="function"))b=O.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof m!="object"||!p?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");b=m}const j=new URL((t=p?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in b&&b.signIn){const O=await b.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},p?.signInWithSolana),{version:"1",domain:j.host,uri:j.href}),E?{statement:E}:null));let D;if(Array.isArray(O)&&O[0]&&typeof O[0]=="object")D=O[0];else if(O&&typeof O=="object"&&"signedMessage"in O&&"signature"in O)D=O;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in D&&"signature"in D&&(typeof D.signedMessage=="string"||D.signedMessage instanceof Uint8Array)&&D.signature instanceof Uint8Array)v=typeof D.signedMessage=="string"?D.signedMessage:new TextDecoder().decode(D.signedMessage),g=D.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in b)||typeof b.signMessage!="function"||!("publicKey"in b)||typeof b!="object"||!b.publicKey||!("toBase58"in b.publicKey)||typeof b.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");v=[`${j.host} wants you to sign in with your Solana account:`,b.publicKey.toBase58(),...E?["",E,""]:[""],"Version: 1",`URI: ${j.href}`,`Issued At: ${(n=(s=p?.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((i=p?.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${p.signInWithSolana.notBefore}`]:[],...!((o=p?.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${p.signInWithSolana.expirationTime}`]:[],...!((a=p?.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${p.signInWithSolana.chainId}`]:[],...!((l=p?.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${p.signInWithSolana.nonce}`]:[],...!((u=p?.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${p.signInWithSolana.requestId}`]:[],...!((h=(c=p?.signInWithSolana)===null||c===void 0?void 0:c.resources)===null||h===void 0)&&h.length?["Resources",...p.signInWithSolana.resources.map(D=>`- ${D}`)]:[]].join(`
`);const O=await b.signMessage(new TextEncoder().encode(v),"utf8");if(!O||!(O instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");g=O}}try{const{data:_,error:m}=await y(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:v,signature:bo(g)},!((d=e.options)===null||d===void 0)&&d.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:H});if(m)throw m;return!_||!_.session||!_.user?{data:{user:null,session:null},error:new it}:(_.session&&(await this._saveSession(_.session),await this._notifyAllSubscribers("SIGNED_IN",_.session)),{data:Object.assign({},_),error:m})}catch(_){if(w(_))return{data:{user:null,session:null},error:_};throw _}}async _exchangeCodeForSession(e){const t=await ce(this.storage,`${this.storageKey}-code-verifier`),[s,n]=(t??"").split("/");try{const{data:i,error:o}=await y(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:H});if(await Z(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new it}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:o})}catch(i){if(w(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:s,token:n,access_token:i,nonce:o}=e,a=await y(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:n,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:H}),{data:l,error:u}=a;return u?{data:{user:null,session:null},error:u}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new it}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:u})}catch(t){if(w(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,n,i,o;try{if("email"in e){const{email:a,options:l}=e;let u=null,c=null;this.flowType==="pkce"&&([u,c]=await Te(this.storage,this.storageKey));const{error:h}=await y(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=l?.data)!==null&&t!==void 0?t:{},create_user:(s=l?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:u,code_challenge_method:c},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:a,options:l}=e,{data:u,error:c}=await y(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(n=l?.data)!==null&&n!==void 0?n:{},create_user:(i=l?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(o=l?.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:u?.message_id},error:c}}throw new ot("You must provide either an email or phone number.")}catch(a){if(w(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var t,s;try{let n,i;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:o,error:a}=await y(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:H});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,u=o.user;return l?.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(n){if(w(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(e){var t,s,n;try{let i=null,o=null;return this.flowType==="pkce"&&([i,o]=await Te(this.storage,this.storageKey)),await y(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((n=e?.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:Mo})}catch(i){if(w(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new ee;const{error:n}=await y(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:n}})}catch(e){if(w(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:n,options:i}=e,{error:o}=await y(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:n,gotrue_meta_security:{captcha_token:i?.captchaToken}},redirectTo:i?.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:s,type:n,options:i}=e,{data:o,error:a}=await y(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:n,gotrue_meta_security:{captcha_token:i?.captchaToken}}});return{data:{user:null,session:null,messageId:o?.message_id},error:a}}throw new ot("You must provide either an email or phone number and a type")}catch(t){if(w(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await ce(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at*1e3-Date.now()<Et:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){const o=await ce(this.userStorage,this.storageKey+"-user");o?.user?e.user=o.user:e.user=Ot()}if(this.storage.isServer&&e.user){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,u,c)=>(!o&&u==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,u,c))})}return{data:{session:e},error:null}}const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await y(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:re}):await this._useSession(async t=>{var s,n,i;const{data:o,error:a}=t;if(a)throw a;return!(!((s=o.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new ee}:await y(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:re})})}catch(t){if(w(t))return fo(t)&&(await this._removeSession(),await Z(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:n,error:i}=s;if(i)throw i;if(!n.session)throw new ee;const o=n.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await Te(this.storage,this.storageKey));const{data:u,error:c}=await y(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:re});if(c)throw c;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(s){if(w(s))return{data:{user:null},error:s};throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new ee;const t=Date.now()/1e3;let s=t,n=!0,i=null;const{payload:o}=jt(e.access_token);if(o.exp&&(s=o.exp,n=s<=t),n){const{session:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(w(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:o,error:a}=t;if(a)throw a;e=(s=o.session)!==null&&s!==void 0?s:void 0}if(!e?.refresh_token)throw new ee;const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(w(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!W())throw new at("No browser detected.");if(e.error||e.error_description||e.error_code)throw new at(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Cr("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new at("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Cr("No code detected.");const{data:E,error:p}=await this._exchangeCodeForSession(e.code);if(p)throw p;const b=new URL(window.location.href);return b.searchParams.delete("code"),window.history.replaceState(window.history.state,"",b.toString()),{data:{session:E.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:n,access_token:i,refresh_token:o,expires_in:a,expires_at:l,token_type:u}=e;if(!i||!a||!o||!u)throw new at("No session defined in URL");const c=Math.round(Date.now()/1e3),h=parseInt(a);let d=c+h;l&&(d=parseInt(l));const f=d-c;f*1e3<=Ae&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${h}s`);const v=d-h;c-v>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",v,d,c):c-v<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",v,d,c);const{data:g,error:_}=await this._getUser(i);if(_)throw _;const m={provider_token:s,provider_refresh_token:n,access_token:i,expires_in:h,expires_at:d,refresh_token:o,token_type:u,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:m,redirectType:e.type},error:null}}catch(s){if(w(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await ce(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return{error:i};const o=(s=n.session)===null||s===void 0?void 0:s.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(ho(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await Z(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=So(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,n;try{const{data:{session:i},error:o}=t;if(o)throw o;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let s=null,n=null;this.flowType==="pkce"&&([s,n]=await Te(this.storage,this.storageKey,!0));try{return await y(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(w(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(w(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:n}=await this._useSession(async i=>{var o,a,l,u,c;const{data:h,error:d}=i;if(d)throw d;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await y(this.fetch,"GET",f,{headers:this.headers,jwt:(c=(u=h.session)===null||u===void 0?void 0:u.access_token)!==null&&c!==void 0?c:void 0})});if(n)throw n;return W()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s?.url),{data:{provider:e.provider,url:s?.url},error:null}}catch(s){if(w(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,n;const{data:i,error:o}=t;if(o)throw o;return await y(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&n!==void 0?n:void 0})})}catch(t){if(w(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await Oo(async n=>(n>0&&await jo(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await y(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:H})),(n,i)=>{const o=200*Math.pow(2,n);return i&&Tt(i)&&Date.now()+o-s<Ae})}catch(s){if(this._debug(t,"error",s),w(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),W()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e,t;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const n=await ce(this.storage,this.storageKey);if(n&&this.userStorage){let o=await ce(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:n.user},await Re(this.userStorage,this.storageKey+"-user",o)),n.user=(e=o?.user)!==null&&e!==void 0?e:Ot()}else if(n&&!n.user&&!n.user){const o=await ce(this.storage,this.storageKey+"-user");o&&o?.user?(n.user=o.user,await Z(this.storage,this.storageKey+"-user"),await Re(this.storage,this.storageKey,n)):n.user=Ot()}if(this._debug(s,"session from storage",n),!this._isValidSession(n)){this._debug(s,"session is not valid"),n!==null&&await this._removeSession();return}const i=((t=n.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<Et;if(this._debug(s,`session has${i?"":" not"} expired with margin of ${Et}s`),i){if(this.autoRefreshToken&&n.refresh_token){const{error:o}=await this._callRefreshToken(n.refresh_token);o&&(console.error(o),Tt(o)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(n.user&&n.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:a}=await this._getUser(n.access_token);!a&&o?.user?(n.user=o.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(s,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(s,"error",n),console.error(n);return}finally{this._debug(s,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new ee;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new mt;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new ee;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const a={session:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(n,"error",i),w(i)){const o={session:null,error:i};return Tt(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,s=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(l){i.push(l)}});if(await Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),s=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!s&&t.user&&await Re(this.userStorage,this.storageKey+"-user",{user:t.user});const n=Object.assign({},t);delete n.user;const i=structuredClone(n);await Re(this.storage,this.storageKey,i)}else{const n=structuredClone(t);await Re(this.storage,this.storageKey,n)}}async _removeSession(){this._debug("#_removeSession()"),await Z(this.storage,this.storageKey),await Z(this.storage,this.storageKey+"-code-verifier"),await Z(this.storage,this.storageKey+"-user"),this.userStorage&&await Z(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&W()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Ae);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((s.expires_at*1e3-e)/Ae);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${Ae}ms, refresh threshold is ${Mt} ticks`),n<=Mt&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Ms)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!W()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const n=[`provider=${encodeURIComponent(t)}`];if(s?.redirectTo&&n.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s?.scopes&&n.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[i,o]=await Te(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});n.push(a.toString())}if(s?.queryParams){const i=new URLSearchParams(s.queryParams);n.push(i.toString())}return s?.skipBrowserRedirect&&n.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;return i?{data:null,error:i}:await y(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=n?.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(w(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,n;const{data:i,error:o}=t;if(o)return{data:null,error:o};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:u}=await y(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(s=i?.session)===null||s===void 0?void 0:s.access_token});return u?{data:null,error:u}:(e.factorType==="totp"&&(!((n=l?.totp)===null||n===void 0)&&n.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(t){if(w(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return{data:null,error:i};const{data:o,error:a}=await y(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(s=n?.session)===null||s===void 0?void 0:s.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})})}catch(t){if(w(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;return i?{data:null,error:i}:await y(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(s=n?.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(w(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=e?.factors||[],n=s.filter(o=>o.factor_type==="totp"&&o.status==="verified"),i=s.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:s,totp:n,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:n},error:i}=e;if(i)return{data:null,error:i};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=jt(n.access_token);let a=null;o.aal&&(a=o.aal);let l=a;((s=(t=n.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(l="aal2");const c=o.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:c},error:null}}))}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(a=>a.kid===e);if(s)return s;const n=Date.now();if(s=this.jwks.keys.find(a=>a.kid===e),s&&this.jwks_cached_at+uo>n)return s;const{data:i,error:o}=await y(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=n,s=i.keys.find(a=>a.kid===e),!s)?null:s}async getClaims(e,t={}){try{let s=e;if(!s){const{data:f,error:v}=await this.getSession();if(v||!f.session)return{data:null,error:v};s=f.session.access_token}const{header:n,payload:i,signature:o,raw:{header:a,payload:l}}=jt(s);t?.allowExpired||Io(i.exp);const u=!n.alg||n.alg.startsWith("HS")||!n.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(n.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!u){const{error:f}=await this.getUser(s);if(f)throw f;return{data:{claims:i,header:n,signature:o},error:null}}const c=Uo(n.alg),h=await crypto.subtle.importKey("jwk",u,c,!0,["verify"]);if(!await crypto.subtle.verify(c,h,o,mo(`${a}.${l}`)))throw new Kt("Invalid JWT signature");return{data:{claims:i,header:n,signature:o},error:null}}catch(s){if(w(s))return{data:null,error:s};throw s}}}Ye.nextInstanceID=0;const Yo=Ye;class Xo extends Yo{constructor(e){super(e)}}var Zo=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{u(s.next(c))}catch(h){o(h)}}function l(c){try{u(s.throw(c))}catch(h){o(h)}}function u(c){c.done?i(c.value):n(c.value).then(a,l)}u((s=s.apply(r,e||[])).next())})};class ea{constructor(e,t,s){var n,i,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const a=so(e),l=new URL(a);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const u=`sb-${l.hostname.split(".")[0]}-auth-token`,c={db:Vi,realtime:Yi,auth:Object.assign(Object.assign({},Qi),{storageKey:u}),global:Gi},h=no(s??{},c);this.storageKey=(n=h.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(i=h.global.headers)!==null&&i!==void 0?i:{},h.accessToken?(this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(d,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=h.auth)!==null&&o!==void 0?o:{},this.headers,h.global.fetch),this.fetch=to(t,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.rest=new pi(new URL("rest/v1",l).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),h.accessToken||this._listenForAuthEvents()}get functions(){return new si(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new zi(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Zo(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,storageKey:i,flowType:o,lock:a,debug:l},u,c){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Xo({url:this.authUrl.href,headers:Object.assign(Object.assign({},h),u),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,flowType:o,lock:a,debug:l,fetch:c,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new xi(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s?.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?this.changedAccessToken=s:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const ta=(r,e,t)=>new ea(r,e,t),ra="https://vycjpmuyscfygstjjied.supabase.co",sa="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ5Y2pwbXV5c2NmeWdzdGpqaWVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcyMTQxMDcsImV4cCI6MjA2Mjc5MDEwN30.3t3wUSpe8n0PHPscRQx5vu_fX9B5_d0bEOJMvwLPYAQ",na=ta(ra,sa);var ia=Yt('<button class="auth-btn svelte-c2kee">Войти через Telegram</button>'),oa=Yt("<p>Для авторизации откройте приложение в Telegram</p>");function aa(r,e){Yr(e,!1);let t=pn(!1);Vn(()=>{G(t,typeof window.Telegram?.WebApp<"u")});const s=async()=>{if(!ne(t)){alert("Эта функция доступна только в Telegram");return}try{const l=window.Telegram.WebApp.initData,{error:u}=await na.auth.signInWithIdToken({provider:"telegram",token:l.user.id,access_token:l.hash});if(u)throw u}catch(l){console.error("Auth error:",l),alert("Ошибка авторизации")}};Gn();var n=Wn(),i=mn(n);{var o=l=>{var u=ia();Mn("click",u,s),lt(l,u)},a=l=>{var u=oa();lt(l,u)};Hn(i,l=>{ne(t)?l(o):l(a,!1)})}lt(r,n),Xr()}var la=Yt('<main><div class="card"><!></div></main>');function ua(r){var e=la(),t=ur(e),s=ur(t);aa(s,{}),lt(r,e)}Kn(ua,{target:document.getElementById("app")});
